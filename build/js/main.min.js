function mixArray(t){for(var e,s,o=t.length;0!==o;)s=Math.floor(Math.random()*o),e=t[--o],t[o]=t[s],t[s]=e;return t}function setQuestion(t,e){var s=e.test[t-1],o=s.question,e=s.answer.img,t=s.options.first,s=s.options.second;$(".test__question").html(o),$(".test__answer > img").attr("src",e),$(".js-btn-option--1").text(t),$(".js-btn-option--2").text(s),$(".test__question").show(),$(".test__answer").hide(),$(".js-btn-option").show(),$(".js-btn-next").hide()}function showResults(s){$.getJSON("result.json",function(t){var e=t.result,t=5<s?2:2<s?1:0;$(".test").hide(),$(".test--result").show(),$(".test--result .test__heading").html(e[t].title),$(".test--result .container img").attr("src",e[t].img),$(".test--result .test__result-text").html(e[t].text)})}$(document).ready(function(){function u(){$.ajax({type:"POST",url:"/get_hashcode/",success:function(t){""!=JSON.parse(t).hashcode&&null!=JSON.parse(t).hashcode&&(hash=JSON.parse(t).hashcode,$(".social").each(function(){var t=$(this).data("url");t+="&u="+encodeURIComponent(hash),$(this).attr("data-url",t)}))}})}window.auth=function(t){$.ajax({type:"POST",url:"/authorize/",data:t,success:function(t){0<t.length&&u()},error:function(){alert("Ошибка авторизации для продолжения")}})};var t,l={fb:"http://www.facebook.com/share.php?u=",vk:"http://vkontakte.ru/share.php?url=",tw:"https://twitter.com/intent/tweet?url=",ok:"http://connect.ok.ru/dk?st.cmd=WidgetSharePreview&service=odnoklassniki&st.shareUrl="};function h(t){t=$('meta[property="og:'+t+'"]');return t.length?t.attr("content"):""}$(".social__link").click(function(){var t,e;for(e in l)if($(this).hasClass(e)){t=e;break}if(null!=t){var s=h("url"),o=h("title"),n=h("description"),i=h("image"),r=$(this).closest(".social"),a=r.attr("data-url");a&&(s=a,i=""),""==s&&(s=window.location.toString());a=r.attr("data-description");a&&(n=a);a=r.attr("data-title");a&&(o=a);r=r.attr("data-image");r&&(i=r);var c=encodeURIComponent(s);switch(t){case"tw":c+="&text="+encodeURIComponent(o);break;case"vk":""!=i&&(c+="&image="+encodeURIComponent(i)),""!=o&&(c+="&title="+encodeURIComponent(o)),""!=n&&(c+="&description="+encodeURIComponent(n));break;case"ok":""!=i&&(c+="&st.imageUrl="+encodeURIComponent(i)),""!=n&&(c+="&st.comments="+encodeURIComponent(n));break;case"fb":""!=i&&(c+="&p[images][0]="+encodeURIComponent(i)),""!=o&&(c+="&p[title]="+encodeURIComponent(o)),""!=n&&(c+="&p[summary]="+encodeURIComponent(n))}"nohash"==$(this).data("mode")?window.open(l[t]+c,t,"width=500,height=500,resizable=yes,scrollbars=yes,status=yes"):(""===hash&&u(),window.open(l[t]+c,t,"width=500,height=500,resizable=yes,scrollbars=yes,status=yes"),s=t,$.ajax({type:"POST",url:"/new_share/",data:{social_share:s},success:function(t){console.log("share ok")}}))}}),t=$(".anchor"),setTimeout(function(){t.click(function(){link=$(this).attr("href"),to=$(link).offset().top,$("body, html").animate({scrollTop:to},800)})},100),$(".js-start").click(function(){curQuestion=0,countQuestion=1,points=0,mixArray(allQuestions.test),countQuestion=allQuestions.test.length,curQuestion++,setQuestion(curQuestion,allQuestions),$(".current-step").text("01"),$(".test--result").hide(),$("#test").show(),$(".test__progress-item").removeClass("test__progress-item--active").first().addClass("test__progress-item--active")}),curQuestion=0,countQuestion=1,points=0,$.getJSON("quiz.json",function(t){allQuestions=t,mixArray(allQuestions.test),countQuestion=allQuestions.test.length,curQuestion++,setQuestion(curQuestion,allQuestions)}),$(".js-btn-option").click(function(){var t=$(this).attr("data-option"),e=allQuestions.test[curQuestion-1].answer;allQuestions.test[curQuestion-1].correct===t?(points++,$(".test__answer-text").html(e.correct)):$(".test__answer-text").html(e.incorrect),$(".test__question").hide(),$(".js-btn-option").hide(),$(".test__answer").show(),$(".js-btn-next").show()}),$(".js-btn-next").click(function(){curQuestion<countQuestion?(curQuestion++,setQuestion(curQuestion,allQuestions),$(".current-step").text(curQuestion.toString().padStart(2,0)),$(".test__progress-item--active").removeClass("test__progress-item--active").next().addClass("test__progress-item--active")):showResults(points)})});